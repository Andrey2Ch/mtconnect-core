<!DOCTYPE html>
<html>
<head>
    <title>MTConnect Test Page</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .machine { border: 1px solid #ccc; margin: 10px; padding: 10px; }
        .available { background: #d4edda; }
        .unavailable { background: #f8d7da; }
    </style>
</head>
<body>
    <h1>üè≠ MTConnect Real Data Test</h1>
    <button onclick="loadData()">üîÑ Load MTConnect Data</button>
    <div id="results"></div>

    <script>
        async function loadData() {
            try {
                const response = await fetch('/current');
                const xmlText = await response.text();
                
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
                
                const deviceStreams = xmlDoc.getElementsByTagName('DeviceStream');
                let html = '<h2>Found ' + deviceStreams.length + ' machines:</h2>';
                
                for (let i = 0; i < deviceStreams.length; i++) {
                    const device = deviceStreams[i];
                    const name = device.getAttribute('name');
                    
                    const availability = device.getElementsByTagName('Availability')[0]?.textContent || 'Unknown';
                    const spindle = device.getElementsByTagName('RotaryVelocity')[0]?.textContent || '0';
                    const load = device.getElementsByTagName('Load')[0]?.textContent || '0';
                    
                    const cssClass = availability === 'AVAILABLE' ? 'available' : 'unavailable';
                    
                    html += `<div class="machine ${cssClass}">
                        <strong>${name}</strong>: ${availability}<br>
                        Spindle: ${spindle} RPM<br>
                        Load: ${load}%
                    </div>`;
                }
                
                document.getElementById('results').innerHTML = html;
                
            } catch (error) {
                document.getElementById('results').innerHTML = '<div style="color: red;">Error: ' + error.message + '</div>';
            }
        }
        
        // Auto-load on page load
        window.onload = loadData;
    </script>
</body>
</html> 