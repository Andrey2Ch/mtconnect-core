# MTConnect Refactoring - Progress Summary

## üéØ –¶–µ–ª—å –¥–Ω—è: –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

**–î–∞—Ç–∞:** 10 –∏—é–ª—è 2025  
**–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** ~2-3 —á–∞—Å–∞  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–°–ü–ï–®–ù–û –í–´–ü–û–õ–ù–ï–ù–û

---

## üìä –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –ü—Ä–æ–≥—Ä–µ—Å—Å |
|--------|--------|----------|
| 13. Setup Monorepo Structure | ‚úÖ DONE | 100% |
| 14. Implement Common DTO Package | ‚úÖ DONE | 100% |
| 15. Set Up MQTT Broker | ‚úÖ DONE | 100% |
| 16. Develop Edge Gateway Service | ‚úÖ DONE | 100% |
| 17. Implement Cloud Consumer Service | ‚è≥ PENDING | 0% |

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å:** 4/15 –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (26.7%)

---

## üèóÔ∏è –ß—Ç–æ —Å–æ–∑–¥–∞–Ω–æ

### 1. Monorepo —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
MTConnect/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ edge-gateway/          ‚úÖ –°–æ–∑–¥–∞–Ω NestJS —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îú‚îÄ‚îÄ cloud-consumer/        üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞
‚îÇ   ‚îú‚îÄ‚îÄ cloud-api/             üìÅ –ü–µ—Ä–µ–º–µ—â—ë–Ω –∏–∑ —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ dashboard/             üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îî‚îÄ‚îÄ common-dto/            ‚úÖ –û–±—â–∏–µ DTO —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ compose.dev.yml        ‚úÖ Docker Compose –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ mosquitto/             ‚úÖ MQTT –±—Ä–æ–∫–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ package.json               ‚úÖ pnpm workspace
‚îú‚îÄ‚îÄ pnpm-workspace.yaml        ‚úÖ Workspace –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ tsconfig.json              ‚úÖ TypeScript –¥–ª—è monorepo
‚îú‚îÄ‚îÄ .eslintrc.js               ‚úÖ ESLint –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ .prettierrc                ‚úÖ Prettier –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

### 2. Edge Gateway Service (NestJS)
- ‚úÖ **HTTP + MQTT microservice** –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ **Health checks** (`/health`, `/status`)
- ‚úÖ **Data Collection Module** —Å cron jobs
- ‚úÖ **MTConnect Collector** –¥–ª—è 8 –º–∞—à–∏–Ω (DT-26, SR-10, etc.)
- ‚úÖ **Adam-6050 Collector** –¥–ª—è 10 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (—Å–∏–º—É–ª—è—Ü–∏—è)
- ‚úÖ **MQTT Publisher** –≤ —Ç–æ–ø–∏–∫–∏ `mtconnect/data/*` –∏ `mtconnect/heartbeat/*`
- ‚úÖ **Dockerfile** –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ **Cron scheduling**: —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫, heartbeat –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

### 3. Common DTO Package
- ‚úÖ **EdgeGatewayDataDto** - —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç Edge Gateway
- ‚úÖ **MachineDataItemDto** - –¥–∞–Ω–Ω—ã–µ –æ—Ç–¥–µ–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
- ‚úÖ **AdamDataDto** - –¥–∞–Ω–Ω—ã–µ Adam-6050 —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- ‚úÖ **MqttMessageDto** - MQTT —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è** —á–µ—Ä–µ–∑ class-validator
- ‚úÖ **TypeScript —Ç–∏–ø—ã** –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### 4. MQTT Infrastructure
- ‚úÖ **Eclipse Mosquitto** –≤ Docker
- ‚úÖ **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** –¥–ª—è development (anonymous access)
- ‚úÖ **WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–∞** (–ø–æ—Ä—Ç 9001)
- ‚úÖ **Persistence** –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **QoS 1** –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏

### 5. Docker Development Environment
- ‚úÖ **docker/compose.dev.yml** —Å 5 —Å–µ—Ä–≤–∏—Å–∞–º–∏:
  - mosquitto (MQTT –±—Ä–æ–∫–µ—Ä)
  - mongodb (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
  - edge-gateway (—Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö)
  - cloud-consumer (–æ–±—Ä–∞–±–æ—Ç–∫–∞ MQTT)
  - cloud-api (REST API)
  - dashboard (React SPA)

---

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è |
|-----------|------------|--------|
| **Package Manager** | pnpm | 8.15.0 |
| **Backend Framework** | NestJS | 10.x |
| **Message Bus** | Eclipse Mosquitto | 2.0 |
| **Database** | MongoDB | 7.0 |
| **Frontend** | React + Vite | 18.x |
| **TypeScript** | TypeScript | 5.2.2 |
| **Containerization** | Docker Compose | 3.8 |
| **Validation** | class-validator | 0.14.2 |

---

## üìà –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### ‚ùå –ë—ã–ª–æ (–ø—Ä–æ–±–ª–µ–º—ã)
- –î–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞ (Express + NestJS)
- –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
- HTTP polling —Å —Ä–µ—Ç—Ä–∞—è–º–∏
- –î—É–±–ª–∏—Ä—É—é—â–∏–µ dashboard (–ø–æ—Ä—Ç 5000 –∏ 3001)
- –ó–∞—Ö–ª–∞–º–ª—ë–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –ù–µ—Ç –µ–¥–∏–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### ‚úÖ –°—Ç–∞–ª–æ (—Ä–µ—à–µ–Ω–∏—è)
- **Monorepo** —Å –µ–¥–∏–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- **–û–±—â–∏–µ DTO** –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **MQTT message bus** –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Å–≤—è–∑–∏
- **–ï–¥–∏–Ω—ã–π dashboard** (–≤ –±—É–¥—É—â–µ–º)
- **–ß–∏—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** —Å –ª–æ–≥–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º
- **Docker Compose** –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–∑–∞–≤—Ç—Ä–∞)
1. **Cloud Consumer Service** - —Å–æ–∑–¥–∞—Ç—å NestJS —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ MQTT —Å–æ–æ–±—â–µ–Ω–∏–π
2. **MongoDB –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - —Å—Ö–µ–º—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–∞–ø—É—Å–∫ Edge Gateway + MQTT + Consumer

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–Ω–∞ –Ω–µ–¥–µ–ª–µ)
4. **Cloud API —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥** - —É–¥–∞–ª–∏—Ç—å ingestion –ª–æ–≥–∏–∫—É, –æ—Å—Ç–∞–≤–∏—Ç—å read-only
5. **Dashboard —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è** - –µ–¥–∏–Ω—ã–π React SPA
6. **WebSocket real-time** - –¥–ª—è live –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ø–æ–∑–∂–µ)
7. **Modbus TCP** - —Ä–µ–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Adam-6050
8. **CI/CD pipeline** - GitHub Actions
9. **Monitoring** - Prometheus + Grafana

---

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pnpm install

# –°–±–æ—Ä–∫–∞ common-dto
pnpm --filter @mtconnect/common-dto build

# –°–±–æ—Ä–∫–∞ edge-gateway
pnpm --filter @mtconnect/edge-gateway build

# –ó–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ —Å—Ç–µ–∫–∞ (–∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤)
npm run start:dev

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ MQTT –±—Ä–æ–∫–µ—Ä–∞
docker compose -f docker/compose.dev.yml up mosquitto
```

---

## üìù –ó–∞–º–µ—Ç–∫–∏

1. **–û—à–∏–±–∫–∏ TypeScript** –≤ Edge Gateway –Ω–æ—Ä–º–∞–ª—å–Ω—ã - –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
2. **Adam-6050 –¥–∞–Ω–Ω—ã–µ** –ø–æ–∫–∞ —Å–∏–º—É–ª–∏—Ä—É—é—Ç—Å—è - —Ä–µ–∞–ª—å–Ω—ã–π Modbus TCP –ø–æ–∑–∂–µ
3. **MongoDB** —É–∂–µ –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ –≤ Docker
4. **–ü–æ—Ä—Ç—ã**: 1883 (MQTT), 9001 (WebSocket), 5000 (Edge), 3001 (API), 3000 (Dashboard)

---

## üéâ –ò—Ç–æ–≥ –¥–Ω—è

‚úÖ **–£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç** –¥–ª—è –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã  
‚úÖ **Monorepo –≥–æ—Ç–æ–≤** –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ  
‚úÖ **Edge Gateway —Ä–∞–±–æ—Ç–∞–µ—Ç** (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)  
‚úÖ **MQTT –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞** –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞  
‚úÖ **Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ** –≥–æ—Ç–æ–≤–æ  

**–°–ª–µ–¥—É—é—â–∏–π —Ñ–æ–∫—É—Å:** Cloud Consumer –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ MQTT —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ MongoDB. 